<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>ChromaWave::DriverExtraction::HeaderGenerator::SequenceFormatting</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='class' id='wrapper'>
<div class='header'>
<h1 class='name'><span class='type'>module</span>
ChromaWave::DriverExtraction::HeaderGenerator::SequenceFormatting
</h1>
<ol class='paths'>
<li>
<a href="../../../../files/lib/chroma_wave/driver_extraction/header_generator/sequence_formatting_rb.html">lib/chroma_wave/driver_extraction/header_generator/sequence_formatting.rb</a>
</li>
</ol>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<p>Methods for formatting init sequences as C array initializers.</p>

<p>Handles encoding of sentinel opcodes, command+data entries, and delay values into formatted C source lines.</p>
</div>
<div id='method-list'>
<h2>Methods</h2>
<h3>Private Instance</h3>
<ol>
<li><a href="#method-i-format_bare_command">format_bare_command</a></li>
<li><a href="#method-i-format_command_entry">format_command_entry</a></li>
<li><a href="#method-i-format_data_line">format_data_line</a></li>
<li><a href="#method-i-format_init_sequence">format_init_sequence</a></li>
<li><a href="#method-i-format_one_entry">format_one_entry</a></li>
<li><a href="#method-i-format_sentinel">format_sentinel</a></li>
<li><a href="#method-i-hex_byte">hex_byte</a></li>
</ol>
</div>
<div id='context'>
<div id='includes'>
<h2>Included modules</h2>
<ol>
<li><a href="../Opcodes.html">Opcodes</a></li>
</ol>
</div>
</div>
<div id='section'>
<div id='methods'>
<h2>Private Instance methods</h2>
<div class='method private-instance' id='method-method-i-format_bare_command'>
<a name='method-i-format_bare_command'></a>
<div class='synopsis'>
<span class='name'>format_bare_command</span><span class='arguments'>(cmd, index, indent)</span>

</div>
<div class='description'>

<p>Formats a command with no data or an invalid count.</p>

<p>@param cmd [Integer] command byte @param index [Integer] current index @param indent [String] indentation prefix @return [Array(String, Integer)] [formatted_line, new_index]</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-format_bare_command-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-format_bare_command-source'><span class="ruby-comment"># File lib/chroma_wave/driver_extraction/header_generator/sequence_formatting.rb, line 69</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">format_bare_command</span>(<span class="ruby-identifier">cmd</span>, <span class="ruby-identifier">index</span>, <span class="ruby-identifier">indent</span>)
  [<span class="ruby-node">&quot;#{indent}#{hex_byte(cmd)}, 0,&quot;</span>, <span class="ruby-identifier">index</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>]
<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method private-instance' id='method-method-i-format_command_entry'>
<a name='method-i-format_command_entry'></a>
<div class='synopsis'>
<span class='name'>format_command_entry</span><span class='arguments'>(sequence, index, indent)</span>

</div>
<div class='description'>

<p>Formats a command byte with its count and data payload.</p>

<p>@param sequence [Array&lt;Integer&gt;] encoded byte sequence @param index [Integer] current index @param indent [String] indentation prefix @return [Array(String, Integer)] [formatted_line, new_index]</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-format_command_entry-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-format_command_entry-source'><span class="ruby-comment"># File lib/chroma_wave/driver_extraction/header_generator/sequence_formatting.rb, line 79</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">format_command_entry</span>(<span class="ruby-identifier">sequence</span>, <span class="ruby-identifier">index</span>, <span class="ruby-identifier">indent</span>)
  <span class="ruby-identifier">cmd</span> = <span class="ruby-identifier">sequence</span>[<span class="ruby-identifier">index</span>]
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">format_bare_command</span>(<span class="ruby-identifier">cmd</span>, <span class="ruby-identifier">index</span>, <span class="ruby-identifier">indent</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">index</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">sequence</span>.<span class="ruby-identifier">length</span>

  <span class="ruby-identifier">count</span> = <span class="ruby-identifier">sequence</span>[<span class="ruby-identifier">index</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>]
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">format_bare_command</span>(<span class="ruby-identifier">cmd</span>, <span class="ruby-identifier">index</span>, <span class="ruby-identifier">indent</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">count</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">0xF0</span>

  <span class="ruby-identifier">data_bytes</span> = <span class="ruby-identifier">sequence</span>[<span class="ruby-identifier">index</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">count</span>] <span class="ruby-operator">||</span> []
  [<span class="ruby-identifier">format_data_line</span>(<span class="ruby-identifier">cmd</span>, <span class="ruby-identifier">count</span>, <span class="ruby-identifier">data_bytes</span>, <span class="ruby-identifier">indent</span>), <span class="ruby-identifier">index</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">count</span>]
<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method private-instance' id='method-method-i-format_data_line'>
<a name='method-i-format_data_line'></a>
<div class='synopsis'>
<span class='name'>format_data_line</span><span class='arguments'>(cmd, count, data_bytes, indent)</span>

</div>
<div class='description'>

<p>Builds the formatted line for a command with data.</p>

<p>@param cmd [Integer] command byte @param count [Integer] data count @param data_bytes [Array&lt;Integer&gt;] data payload @param indent [String] indentation prefix @return [String]</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-format_data_line-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-format_data_line-source'><span class="ruby-comment"># File lib/chroma_wave/driver_extraction/header_generator/sequence_formatting.rb, line 97</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">format_data_line</span>(<span class="ruby-identifier">cmd</span>, <span class="ruby-identifier">count</span>, <span class="ruby-identifier">data_bytes</span>, <span class="ruby-identifier">indent</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-node">&quot;#{indent}#{hex_byte(cmd)}, 0,&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">data_bytes</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-identifier">data_str</span> = <span class="ruby-identifier">data_bytes</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">hex_byte</span>(<span class="ruby-identifier">b</span>) }.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;, &#39;</span>)
  <span class="ruby-node">&quot;#{indent}#{hex_byte(cmd)}, #{count}, #{data_str},&quot;</span>
<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method private-instance' id='method-method-i-format_init_sequence'>
<a name='method-i-format_init_sequence'></a>
<div class='synopsis'>
<span class='name'>format_init_sequence</span><span class='arguments'>(sequence, indent = ' ')</span>

</div>
<div class='description'>

<p>Generates the C array initializer for an init sequence.</p>

<p>@param sequence [Array&lt;Integer&gt;] encoded byte sequence @param indent [String] indentation prefix @return [String] C array content</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-format_init_sequence-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-format_init_sequence-source'><span class="ruby-comment"># File lib/chroma_wave/driver_extraction/header_generator/sequence_formatting.rb, line 20</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">format_init_sequence</span>(<span class="ruby-identifier">sequence</span>, <span class="ruby-identifier">indent</span> = <span class="ruby-string">&#39;    &#39;</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">sequence</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">sequence</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-identifier">lines</span> = []
  <span class="ruby-identifier">i</span> = <span class="ruby-value">0</span>
  <span class="ruby-keyword">while</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">sequence</span>.<span class="ruby-identifier">length</span>
    <span class="ruby-identifier">line</span>, <span class="ruby-identifier">i</span> = <span class="ruby-identifier">format_one_entry</span>(<span class="ruby-identifier">sequence</span>, <span class="ruby-identifier">i</span>, <span class="ruby-identifier">indent</span>)
    <span class="ruby-identifier">lines</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">line</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>)
<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method private-instance' id='method-method-i-format_one_entry'>
<a name='method-i-format_one_entry'></a>
<div class='synopsis'>
<span class='name'>format_one_entry</span><span class='arguments'>(sequence, index, indent)</span>

</div>
<div class='description'>

<p>Formats a single entry (sentinel or command) from a sequence.</p>

<p>@param sequence [Array&lt;Integer&gt;] encoded byte sequence @param index [Integer] current index @param indent [String] indentation prefix @return [Array(String, Integer)] [formatted_line, new_index]</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-format_one_entry-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-format_one_entry-source'><span class="ruby-comment"># File lib/chroma_wave/driver_extraction/header_generator/sequence_formatting.rb, line 38</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">format_one_entry</span>(<span class="ruby-identifier">sequence</span>, <span class="ruby-identifier">index</span>, <span class="ruby-identifier">indent</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">SENTINEL_NAMES</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">sequence</span>[<span class="ruby-identifier">index</span>])
    <span class="ruby-identifier">format_sentinel</span>(<span class="ruby-identifier">sequence</span>, <span class="ruby-identifier">index</span>, <span class="ruby-identifier">indent</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">format_command_entry</span>(<span class="ruby-identifier">sequence</span>, <span class="ruby-identifier">index</span>, <span class="ruby-identifier">indent</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method private-instance' id='method-method-i-format_sentinel'>
<a name='method-i-format_sentinel'></a>
<div class='synopsis'>
<span class='name'>format_sentinel</span><span class='arguments'>(sequence, index, indent)</span>

</div>
<div class='description'>

<p>Formats a sentinel opcode and its optional delay argument.</p>

<p>@param sequence [Array&lt;Integer&gt;] encoded byte sequence @param index [Integer] current index @param indent [String] indentation prefix @return [Array(String, Integer)] [formatted_line, new_index]</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-format_sentinel-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-format_sentinel-source'><span class="ruby-comment"># File lib/chroma_wave/driver_extraction/header_generator/sequence_formatting.rb, line 52</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">format_sentinel</span>(<span class="ruby-identifier">sequence</span>, <span class="ruby-identifier">index</span>, <span class="ruby-identifier">indent</span>)
  <span class="ruby-identifier">byte</span> = <span class="ruby-identifier">sequence</span>[<span class="ruby-identifier">index</span>]
  <span class="ruby-identifier">name</span> = <span class="ruby-constant">SENTINEL_NAMES</span>[<span class="ruby-identifier">byte</span>]

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">byte</span> <span class="ruby-operator">==</span> <span class="ruby-constant">SEQ_DELAY_MS</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">index</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">sequence</span>.<span class="ruby-identifier">length</span>
    [<span class="ruby-node">&quot;#{indent}#{name}, #{sequence[index + 1]},&quot;</span>, <span class="ruby-identifier">index</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span>]
  <span class="ruby-keyword">else</span>
    [<span class="ruby-node">&quot;#{indent}#{name},&quot;</span>, <span class="ruby-identifier">index</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method private-instance' id='method-method-i-hex_byte'>
<a name='method-i-hex_byte'></a>
<div class='synopsis'>
<span class='name'>hex_byte</span><span class='arguments'>(value)</span>

</div>
<div class='description'>

<p>Formats a hex byte for C output.</p>

<p>@param value [Integer] byte value @return [String]</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-hex_byte-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-hex_byte-source'><span class="ruby-comment"># File lib/chroma_wave/driver_extraction/header_generator/sequence_formatting.rb, line 108</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">hex_byte</span>(<span class="ruby-identifier">value</span>)
  <span class="ruby-identifier">format</span>(<span class="ruby-string">&#39;0x%02X&#39;</span>, <span class="ruby-identifier">value</span>)
<span class="ruby-keyword">end</span></pre>
</div>
</div>
</div>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna"><strong>Hanna</strong> RDoc template</a>
</div>
</body>
</html>
